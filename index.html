<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A calm recipe collection by Markus Condren." />
  <title>Recipes — Markus Condren</title>

  <style>
    :root{
      /* Calm earthy palette */
      --bg: #f6f2ea;           /* warm off-white */
      --ink: #1f2320;          /* soft near-black */
      --muted: rgba(31,35,32,.68);
      --card: rgba(255,255,255,.62);
      --border: rgba(31,35,32,.10);
      --shadow: 0 18px 55px rgba(31,35,32,.10);

      --green: #3f6f58;        /* muted green */
      --orange: #c77a3b;       /* muted orange */

      --radius: 18px;
      --max: 1120px;
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      background: radial-gradient(900px 500px at 15% 10%, rgba(63,111,88,.10), transparent 60%),
                  radial-gradient(900px 600px at 85% 20%, rgba(199,122,59,.09), transparent 60%),
                  var(--bg);
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 26px 18px 60px;
    }

    /* Top bar */
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      border-bottom: 1px solid rgba(31,35,32,.06);
    }

    .topbar{
      max-width: var(--max);
      margin: 0 auto;
      padding: 16px 18px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 220px;
    }

    .logoBox{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 75%, transparent);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 25px rgba(31,35,32,.08);
      font-weight: 700;
      letter-spacing: .3px;
    }

    .brandText{
      display:flex;
      flex-direction: column;
      line-height: 1.1;
    }
    .brandText strong{ font-size: 14px; }
    .brandText span{ font-size: 12px; color: var(--muted); }

    .controls{
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .search{
      display:flex;
      align-items:center;
      gap: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      border-radius: 999px;
      padding: 10px 12px;
      min-width: 240px;
      box-shadow: 0 10px 20px rgba(31,35,32,.06);
    }
    .search input{
      border: none;
      outline: none;
      background: transparent;
      width: 100%;
      font-size: 14px;
      color: var(--ink);
    }
    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--muted);
      user-select: none;
      box-shadow: 0 10px 20px rgba(31,35,32,.06);
    }
    .dot{
      display:inline-block;
      width: 8px; height: 8px;
      border-radius: 999px;
      background: var(--green);
      margin-right: 8px;
      box-shadow: 0 0 18px rgba(63,111,88,.25);
      vertical-align: middle;
    }

    /* Page intro */
    .intro{
      padding: 24px 0 18px;
      display:flex;
      justify-content: space-between;
      gap: 18px;
      align-items: flex-end;
      flex-wrap: wrap;
    }
    h1{
      margin: 0;
      font-size: clamp(26px, 4vw, 40px);
      letter-spacing: -0.6px;
    }
    .sub{
      margin: 8px 0 0;
      color: var(--muted);
      max-width: 68ch;
      font-size: 14px;
      line-height: 1.6;
    }

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(8, 1fr); }
    }
    @media (max-width: 720px){
      .grid{ grid-template-columns: repeat(4, 1fr); }
      .search{ min-width: 0; width: 52vw; }
      .brand{ min-width: 0; }
    }

    .card{
      grid-column: span 4;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.52);
      box-shadow: var(--shadow);
      overflow: hidden;
      text-decoration: none;
      color: inherit;
      transform: translateY(0);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      position: relative;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(31,35,32,.16);
      background: rgba(255,255,255,.64);
    }

    .thumb{
      aspect-ratio: 4 / 3;
      width: 100%;
      display:block;
      object-fit: cover;
      filter: saturate(.95) contrast(.98);
      transform: scale(1.02);
      transition: transform .35s ease;
    }
    .card:hover .thumb{ transform: scale(1.06); }

    .meta{
      padding: 12px 12px 14px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: start;
    }

    .title{
      font-size: 14px;
      font-weight: 650;
      letter-spacing: -0.2px;
      margin: 0;
      line-height: 1.25;
    }
    .tags{
      margin-top: 6px;
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      color: var(--muted);
      font-size: 12px;
    }
    .tag{
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(31,35,32,.10);
      background: rgba(255,255,255,.45);
    }

    .badge{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31,35,32,.12);
      background: rgba(255,255,255,.55);
      color: var(--muted);
      white-space: nowrap;
    }
    .badge b{
      color: var(--ink);
      font-weight: 650;
    }
    .badge .accent{
      color: var(--orange);
      font-weight: 700;
      margin-right: 6px;
    }

    /* Fade-in animation when cards appear */
    .reveal{
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .reveal.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* Loader */
    .loader{
      display:flex;
      justify-content:center;
      padding: 20px 0 0;
      color: var(--muted);
      font-size: 13px;
    }

    footer{
      margin-top: 28px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logoBox" title="Logo placeholder">MC</div>
        <div class="brandText">
          <strong>Markus Condren</strong>
          <span>recipes — calm & minimal</span>
        </div>
      </div>

      <div class="controls">
        <div class="search" role="search">
          <span class="mono" aria-hidden="true" style="color: var(--muted);">⌕</span>
          <input id="search" type="search" placeholder="Search recipes…" autocomplete="off" />
        </div>
        <div class="chip"><span class="dot" aria-hidden="true"></span>PDF recipes</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <section class="intro">
      <div>
        <h1>A small recipe shelf.</h1>
        <p class="sub">
          Click any card to open the recipe as a PDF in a new tab. New recipes get added over time.
        </p>
      </div>
      <div class="badge"><span class="accent">●</span><b id="count">0</b> recipes indexed</div>
    </section>

    <section id="grid" class="grid" aria-label="Recipe feed"></section>
    <div id="loader" class="loader">Loading…</div>

    <footer>
      <div>© <span id="year"></span> Markus Condren</div>
      <div class="mono">markuscondren.com</div>
    </footer>
  </div>

  <script>
    /**
     * Minimal infinite scroll:
     * - Loads recipes.json once
     * - Filters locally on search
     * - Renders in chunks
     */

    const PAGE_SIZE = 12;

    let all = [];
    let filtered = [];
    let cursor = 0;

    const grid = document.getElementById("grid");
    const loader = document.getElementById("loader");
    const search = document.getElementById("search");
    const count = document.getElementById("count");

    document.getElementById("year").textContent = new Date().getFullYear();

    function normalize(s){
      return (s || "").toLowerCase().trim();
    }

    function matches(recipe, q){
      if (!q) return true;
      const hay = [
        recipe.title,
        recipe.description,
        ...(recipe.tags || []),
        ...(recipe.ingredients || [])
      ].join(" ");
      return normalize(hay).includes(q);
    }

    function cardHTML(r){
      const tags = (r.tags || []).slice(0, 4).map(t => `<span class="tag">${t}</span>`).join("");
      const time = r.time ? `${r.time}` : "";
      const accent = r.category ? r.category : "Recipe";

      return `
        <a class="card reveal" href="${r.pdf}" target="_blank" rel="noopener noreferrer">
          <img class="thumb" src="${r.image}" alt="${r.title}" loading="lazy" />
          <div class="meta">
            <div>
              <p class="title">${r.title}</p>
              <div class="tags">${tags}</div>
            </div>
            <div class="badge"><span class="accent">●</span><b>${accent}</b>${time ? ` · ${time}` : ""}</div>
          </div>
        </a>
      `;
    }

    function revealNewCards(){
      const cards = grid.querySelectorAll(".reveal:not(.show)");
      const io = new IntersectionObserver(entries => {
        for (const e of entries){
          if (e.isIntersecting){
            e.target.classList.add("show");
            io.unobserve(e.target);
          }
        }
      }, { threshold: 0.12 });

      cards.forEach(c => io.observe(c));
    }

    function renderNext(){
      const slice = filtered.slice(cursor, cursor + PAGE_SIZE);
      if (slice.length === 0){
        loader.textContent = filtered.length ? "End." : "No recipes found.";
        return;
      }

      const html = slice.map(cardHTML).join("");
      grid.insertAdjacentHTML("beforeend", html);
      cursor += slice.length;

      loader.textContent = cursor < filtered.length ? "Loading…" : "End.";
      revealNewCards();
    }

    function resetAndRender(){
      grid.innerHTML = "";
      cursor = 0;
      loader.textContent = "Loading…";
      renderNext();
    }

    function applyFilter(){
      const q = normalize(search.value);
      filtered = all.filter(r => matches(r, q));
      resetAndRender();
    }

    async function init(){
      const res = await fetch("./recipes.json", { cache: "no-store" });
      all = await res.json();

      // Optional: newest first if you include a date field
      all.sort((a,b) => (b.date || "").localeCompare(a.date || ""));

      filtered = all;
      count.textContent = String(all.length);

      resetAndRender();
    }

    // Infinite scroll sentinel
    const sentinel = document.createElement("div");
    sentinel.style.height = "1px";
    document.body.appendChild(sentinel);

    const scrollObserver = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting){
        // Only load more if there is more
        if (cursor < filtered.length) renderNext();
      }
    }, { rootMargin: "600px 0px" });

    scrollObserver.observe(sentinel);

    // Search (debounced)
    let t = null;
    search.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(applyFilter, 120);
    });

    init().catch(() => {
      loader.textContent = "Couldn’t load recipes.json";
    });
  </script>
</body>
</html>
